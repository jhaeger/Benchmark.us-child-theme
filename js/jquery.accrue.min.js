!function(t,e){t.extend(t.fn,{accrue:function(e){return e=t.extend({calculationMethod:n},t.fn.accrue.options,e),this.each(function(){var m=t(this);m.find(".form").length||m.append('<div class="form"></div>'),a(m,e,"amount"),a(m,e,"rate"),a(m,e,"term"),"compare"==e.mode&&a(m,e,"rate_compare");var l;".results"===e.response_output_div?(0===m.find(".results").length&&m.append('<div class="results"></div>'),l=m.find(".results")):l=t(e.response_output_div);var s;switch(e.mode){case"basic":s=n;break;case"compare":s=o;break;case"amortization":s=r}s(m,e,l),"button"==e.operation?(0===m.find("button").length&&0===m.find("input[type=submit]").length&&0===m.find("input[type=image]").length&&m.find(".form").append('<button class="accrue-calculate">'+e.button_label+"</button>"),m.find("button, input[type=submit], input[type=image]").each(function(){t(this).click(function(t){t.preventDefault(),s(m,e,l)})})):m.find("input, select").each(function(){t(this).bind("keyup change",function(){s(m,e,l)})}),m.find("form").each(function(){t(this).submit(function(t){t.preventDefault(),s(m,e,l)})})})}}),t.fn.accrue.options={mode:"basic",operation:"keyup",default_values:{amount:"",rate:"5%",rate_compare:"4%",term:"30y"},field_titles:{amount:"Loan Amount",rate:"Rate (APR)",rate_compare:"Comparison Rate",term:"Term"},button_label:"Calculate",field_comments:{amount:"",rate:"",rate_compare:"",term:"Format: 12m, 36m, 15y, 30y"},response_output_div:".results",response_basic:"<p><strong>Monthly Payment:</strong><br />$%payment_amount%</p><p><strong>Number of Payments:</strong><br />%num_payments%</p><p><strong>Total Payments:</strong><br />$%total_payments%</p><p><strong>Total Interest:</strong><br />$%total_interest%</p>",response_compare:'<p class="total-savings">Save $%savings% in interest!</p>',error_text:'<p class="error">Please fill in all fields.</p>',callback:function(){}};var a=function(t,e,a){var n;return t.find(".accrue-"+a).length?n=t.find(".accrue-"+a):t.find("."+a).length?n=t.find("."+a):t.find("input[name~="+a+"]").length?t.find("input[name~="+a+"]"):n="","string"!=typeof n?n.val():"term_compare"==a?!1:(t.find(".form").append('<div class="accrue-field-'+a+'"><p><label>'+e.field_titles[a]+':</label><input type="text" class="'+a+'" value="'+e.default_values[a]+'" />'+(e.field_comments[a].length>0?"<small>"+e.field_comments[a]+"</small>":"")+"</p></div>"),t.find("."+a).val())},n=function(e,n,o){var r=t.loanInfo({amount:a(e,n,"amount"),rate:a(e,n,"rate"),term:a(e,n,"term")});if(0!==r){var m=n.response_basic.replace("%payment_amount%",r.payment_amount_formatted).replace("%num_payments%",r.num_payments).replace("%total_payments%",r.total_payments_formatted).replace("%total_interest%",r.total_interest_formatted);o.html(m)}else o.html(n.error_text);n.callback(e,r)},o=function(e,n,o){var r=a(e,n,"term_compare");"boolean"==typeof r&&(r=a(e,n,"term"));var m=t.loanInfo({amount:a(e,n,"amount"),rate:a(e,n,"rate"),term:a(e,n,"term")}),l=t.loanInfo({amount:a(e,n,"amount"),rate:a(e,n,"rate_compare"),term:r}),s={loan_1:m,loan_2:l};if(0!==m&&0!==l){s.savings=m.total_interest-l.total_interest>0?m.total_interest-l.total_interest:0;var i=n.response_compare.replace("%savings%",s.savings.toFixed(2)).replace("%loan_1_payment_amount%",l.payment_amount_formatted).replace("%loan_1_num_payments%",l.num_payments).replace("%loan_1_total_payments%",l.total_payments_formatted).replace("%loan_1_total_interest%",l.total_interest_formatted).replace("%loan_2_payment_amount%",m.payment_amount_formatted).replace("%loan_2_num_payments%",m.num_payments).replace("%loan_2_total_payments%",m.total_payments_formatted).replace("%loan_2_total_interest%",m.total_interest_formatted);o.html(i)}else o.html(n.error_text);n.callback(e,s)},r=function(e,n,o){var r=t.loanInfo({amount:a(e,n,"amount"),rate:a(e,n,"rate"),term:a(e,n,"term")});if(0!==r){for(var m='<table class="accrue-amortization"><tr><th class="accrue-payment-number">#</th><th class="accrue-payment-amount">Payment Amt.</th><th class="accrue-total-interest">Total Interest</th><th class="accrue-total-payments">Total Payments</th><th class="accrue-balance">Balance</th></tr>',l=r.payment_amount-r.original_amount/r.num_payments,s=r.payment_amount-l,i=0,c=0,p=parseInt(r.original_amount),u=0;u<r.num_payments;u++){i+=l,c+=r.payment_amount,p-=s;var _="td";u==r.num_payments-1&&(_="th"),m=m+"<tr><"+_+' class="accrue-payment-number">'+(u+1)+"</"+_+"><"+_+' class="accrue-payment-amount">$'+r.payment_amount_formatted+"</"+_+"><"+_+' class="accrue-total-interest">$'+i.toFixed(2)+"</"+_+"><"+_+' class="accrue-total-payments">$'+c.toFixed(2)+"</"+_+"><"+_+' class="accrue-balance">$'+p.toFixed(2)+"</"+_+"></tr>"}m+="</table>",o.html(m)}else o.html(n.error_text);n.callback(e,r)};t.loanInfo=function(t){var e=("undefined"!=typeof t.amount?t.amount:0).replace(/[^\d.]/gi,""),a=("undefined"!=typeof t.rate?t.rate:0).replace(/[^\d.]/gi,""),n="undefined"!=typeof t.term?t.term:0;n=n.match("y")?12*parseInt(n.replace(/[^\d.]/gi,"")):parseInt(n.replace(/[^\d.]/gi,""));var o=a/100/12,r=Math.pow(1+o,n),m=e*r*o/(r-1);return e*a*n>0?{original_amount:e,payment_amount:m,payment_amount_formatted:m.toFixed(2),num_payments:n,total_payments:m*n,total_payments_formatted:(m*n).toFixed(2),total_interest:m*n-e,total_interest_formatted:(m*n-e).toFixed(2)}:0}}(jQuery,window,document);